<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <title>L√©n√°nak ‚Äì Napi j√≥k√≠v√°ns√°g</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, #ffe5f1, #f6f0ff 45%, #ffe0cc 90%);
      color: #3b2a3f;
    }

    .app {
      width: 100%;
      max-width: 420px;
      padding: 20px 16px 32px;
    }

    .header {
      text-align: center;
      margin-bottom: 20px;
    }

    .header-title {
      font-size: 1.6rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      margin-bottom: 4px;
    }

    .header-subtitle {
      font-size: 1rem;
      opacity: 0.8;
      margin-bottom: 6px;
    }

    .date {
      font-size: 0.9rem;
      opacity: 0.8;
    }

    .scene {
      position: relative;
      height: 270px;
      max-height: 65vh;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 10px 0 12px;
      perspective: 1000px;
    }

    .envelope,
    .card {
      position: absolute;
      border: none;
      background: none;
      padding: 0;
      cursor: pointer;
      -webkit-tap-highlight-color: transparent;
    }

    .envelope {
      width: 260px;
      height: 180px;
      border-radius: 18px;
      background: linear-gradient(145deg, #ffe1e8, #ffcfd9);
      box-shadow:
        0 14px 28px rgba(212, 123, 150, 0.35),
        0 4px 10px rgba(255, 255, 255, 0.9) inset;
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      transform-origin: center;
      transition: opacity 0.5s ease, transform 0.5s ease;
    }

    .envelope::before {
      content: "";
      position: absolute;
      inset: 0;
      background:
        linear-gradient(135deg, rgba(255,255,255,0.8), transparent 45%),
        repeating-linear-gradient(
          -45deg,
          rgba(255,126,167,0.65),
          rgba(255,126,167,0.65) 8px,
          rgba(255,255,255,0.6) 8px,
          rgba(255,255,255,0.6) 16px
        );
      mix-blend-mode: soft-light;
      opacity: 0.6;
      pointer-events: none;
    }

    .envelope-top {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 55%;
      background: linear-gradient(145deg, #ffd7e3, #ffc1d2);
      clip-path: polygon(0 0, 100% 0, 50% 100%);
      transform-origin: top;
      transition: transform 0.5s ease;
      box-shadow: 0 10px 18px rgba(204, 112, 143, 0.35);
    }

    .envelope-label {
      position: relative;
      text-align: center;
      padding: 10px 16px;
      z-index: 1;
    }

    .label-name {
      font-size: 1.1rem;
      font-weight: 600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      margin-bottom: 4px;
    }

    .label-date {
      font-size: 0.9rem;
      opacity: 0.85;
      margin-bottom: 6px;
    }

    .label-hint {
      font-size: 0.8rem;
      opacity: 0.75;
    }

    .heart {
      position: absolute;
      bottom: 14px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 1.3rem;
      opacity: 0.9;
    }

    .card {
      width: 260px;
      height: 180px;
      border-radius: 18px;
      background: #fffdf9;
      box-shadow:
        0 18px 32px rgba(191, 158, 134, 0.45),
        0 0 0 1px rgba(255, 235, 220, 1);
      padding: 18px 18px 16px;
      display: flex;
      justify-content: center;
      align-items: center;
      transform-origin: center;
      transform: translateY(40px) scale(0.9);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s ease, transform 0.5s ease;
    }

    .card-inner {
      width: 100%;
      height: 100%;
      border-radius: 12px;
      background:
        radial-gradient(circle at top left, #ffeef5, transparent 50%),
        radial-gradient(circle at bottom right, #fff2de, transparent 55%),
        #fffdf9;
      padding: 10px 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    /* Szaggatott keret ELT√ÅVOL√çTVA ‚Äì itt kor√°bban ::before volt */

    #message {
      font-size: 1rem;
      line-height: 1.4;
      padding: 4px;
      z-index: 1;
    }

    .corner-decor {
      position: absolute;
      font-size: 1.4rem; /* kicsit nagyobb */
      opacity: 0.6;
    }

    .corner-decor.tl {
      top: 6px;
      left: 8px;
    }
    .corner-decor.br {
      bottom: 6px;
      right: 8px;
    }

    .scene.open .envelope {
      opacity: 0;
      pointer-events: none;
      transform: translateY(-40px) scale(0.9) rotateX(20deg);
    }

    .scene.open .envelope-top {
      transform: rotateX(160deg);
    }

    .scene.open .card {
      opacity: 1;
      pointer-events: auto;
      transform: translateY(0) scale(1);
    }

    .hint {
      text-align: center;
      font-size: 0.85rem;
      opacity: 0.8;
      margin-top: 6px;
    }

    .hint span {
      font-size: 1rem;
    }

    @media (prefers-reduced-motion: reduce) {
      .envelope,
      .card,
      .envelope-top {
        transition: none !important;
      }
    }
  </style>
</head>
<body>

  <div class="app">
    <div class="header">
      <div class="header-title">L√©n√°nak</div>
      <div class="header-subtitle">Napi j√≥k√≠v√°ns√°g-k√°rtya</div>
      <div class="date" id="date"></div>
    </div>

    <div class="scene closed" id="scene">
      <!-- BOR√çT√âK -->
      <button class="envelope" id="envelope" type="button"
              onclick="openCard()"
              aria-label="Koppints a bor√≠t√©kra, hogy kinyisd a mai k√°rty√°t!">
        <div class="envelope-top"></div>
        <div class="envelope-label">
          <div class="label-name">L√©n√°nak</div>
          <div class="label-date" id="envelopeDate"></div>
          <div class="label-hint">Koppints ide, hogy kinyisd a mai √ºzeneted üíå</div>
        </div>
        <div class="heart">‚ô°</div>
      </button>

      <!-- K√ÅRTYA -->
      <button class="card" id="card" type="button"
              onclick="closeCard()"
              aria-label="Koppints a k√°rty√°ra, hogy visszaker√ºlj√∂n a bor√≠t√©kba!">
        <div class="card-inner">
          <div class="corner-decor tl">üåπ</div>
          <p id="message"></p>
          <div class="corner-decor br">üåπ</div>
        </div>
      </button>
    </div>

    <div class="hint">
      Minden nap √∫j k√°rtya v√°r r√°d <span>üíå</span>
    </div>
  </div>

<script>
  // ---- BE√ÅLL√çT√ÅSOK ----
  const TIMEZONE = "Europe/Bucharest";     // Rom√°niai id≈ëz√≥na

  // √öJ KULCSOK ‚Äì ezzel "resetel≈ëdik" a randomiz√°ci√≥
  const STORAGE_KEY = "lena_daily_card_v5";
  const HISTORY_KEY = "lena_daily_card_history_v5";
  const NO_REPEAT_DAYS = 10;

  const BIRTHDAY_MONTH = 5;  // m√°jus
  const BIRTHDAY_DAY = 25;

  const BIRTHDAY_MESSAGE = "Boldog Sz√ºlet√©snapot! Minden √°lmod v√°ljon val√≥ra!";

  // √úZENETLISTA ‚Äì minden sor v√©g√©n van vessz≈ë, csak az utols√≥n nincs
  const MESSAGES = [
    'Lepd meg magad egy apr√≥ gesztussal ma, meg√©rdemled! ‚ò∫Ô∏è',
    'Tudd, hogy ritka k√ºl√∂nleges ember vagy. Kiemelkedsz a t√∂megb≈ël, f≈ëleg a sz√≠veddel, humoroddal‚ò∫Ô∏è',
    'Ha belen√©zel a t√ºk√∂rbe, akkor egy gy√∂ny√∂r≈± h√∂lgy n√©z vissza r√°d! ü´∂',
    'A mosolyod a legszebb √©kszered, vedd h√°t fel ma is! ü´∂',
    'Okos h√∂lgy vagy: hamar megl√°tsz olyan √∂sszef√ºgg√©seket, amiket m√°s nem! üßê',
    'Nagyon sokat fejl≈ëdt√©l az elm√∫lt √©vekben, b√ºszke lehetsz magadra, csak √≠gy tov√°bb! üôå',
    'Ma egy sz√≥viccet kapsz: mi√©rt nem l√°tj√°k P√°lt az erd≈ëben? Mert p√°lmafa üå¥',
    'Nem is sejted, h√°ny lelket gy√≥gy√≠tott√°l meg a remek (√©s meglehet≈ësen egyedi) humoroddal! üòÇ',
    'A mai k√°rtya egyenesen Puffancst√≥l van: "Szia L√©na! Csak azt akarom mondani, hogy nagyon szeretlek!üß∏"',
    'Rem√©lem, hogy egyszer magad is elhiszed, hogy gy√∂ny√∂r≈± h√∂lgy vagy‚ò∫Ô∏è',
    'A l√°bujjaid pont √∫gy t√∂k√©letesek, ahogy vannak (az orrod is). Sajn√°lom, hogy vicceltem vele!üòÇ',
    'Gy√∂ny√∂r≈± lelked van, ezt m√°r bebizony√≠tottad. B√°r t√∂bb olyan ember lenne, mint te! ü´∂',
    'Rengeteget lehet t≈ëled tanulni. A t√°rsas√°god nem csak √©rt√©kes, de fejleszt≈ë is. ‚ò∫Ô∏è',
    'Mosoly-nap a mai, √≠gy h√°t egy vicc: hogyan kapta Nep√°l a nev√©t? "B√°rmi legyen, csak ne P√°l!" üòÇ',
    'Nagyon j√≥ √©desanyja volt√°l Kormik√°t√≥l Steviek√©ig az √∂sszes kis cic√°dnak! H√°l√°sak neked ü•∫ü´∂',
    'Nagyon figyelmes vagy, √©rzelmileg √©rett √©s j√≥sz√≠v≈± az elesettekkel. Maradj mindig ilyen üòá',
    'Fantasztikus a mem√≥ri√°d (nem csak vit√°kn√°l): dalsz√∂vegek, versek, mond√≥k√°k. Remek eszed van! ‚ò∫Ô∏è',
    'Te vagy a legszebb arc√∫ h√∂lgy, akit eme app k√©sz√≠t≈ëje valaha l√°tott ‚Äì ≈ëszint√©n. ü§ç'
  ];

  // ---- ID≈êZ√ìNA SZERINTI D√ÅTUM ----
  function getTodayInBucharest() {
    const now = new Date();
    const parts = new Intl.DateTimeFormat("hu-HU", {
      timeZone: TIMEZONE,
      year: "numeric",
      month: "2-digit",
      day: "2-digit"
    }).formatToParts(now);

    let y, m, d;
    for (const p of parts) {
      if (p.type === "year") y = p.value;
      if (p.type === "month") m = p.value;
      if (p.type === "day") d = p.value;
    }
    return { year: Number(y), month: Number(m), day: Number(d) };
  }

  function dateKey(obj) {
    const year = obj.year;
    const month = obj.month;
    const day = obj.day;
    const mm = String(month).padStart(2, "0");
    const dd = String(day).padStart(2, "0");
    return year + "-" + mm + "-" + dd;
  }

  function formatHungarianDate(obj) {
    const year = obj.year;
    const month = obj.month;
    const day = obj.day;
    const dt = new Date(Date.UTC(year, month - 1, day));
    return dt.toLocaleDateString("hu-HU", {
      year: "numeric",
      month: "long",
      day: "numeric",
      timeZone: TIMEZONE
    });
  }

  // ---- STORAGE SEG√âDF√úGGV√âNYEK ----
  function loadStoredCard() {
    try {
      return JSON.parse(localStorage.getItem(STORAGE_KEY)) || null;
    } catch (e) {
      return null;
    }
  }

  function saveStoredCard(data) {
    try {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    } catch (e) {
      // ha priv√°t m√≥d, ignor√°ljuk
    }
  }

  function loadHistory() {
    try {
      return JSON.parse(localStorage.getItem(HISTORY_KEY)) || [];
    } catch (e) {
      return [];
    }
  }

  function saveHistory(history) {
    try {
      localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
    } catch (e) {
      // ignor√°ljuk, ha nem engedi
    }
  }

  // ---- K√ÅRTYA KISORSOL√ÅSA ----
  function pickMessageIndexWithNoRepeat(history) {
    var allIndices = [];
    for (var i = 0; i < MESSAGES.length; i++) {
      allIndices.push(i);
    }

    var disallowed = {};
    for (var j = 0; j < history.length; j++) {
      disallowed[history[j]] = true;
    }

    var candidates = [];
    for (var k = 0; k < allIndices.length; k++) {
      if (!disallowed[allIndices[k]]) {
        candidates.push(allIndices[k]);
      }
    }

    var pool = candidates.length > 0 ? candidates : allIndices;
    var randomIndex = Math.floor(Math.random() * pool.length);
    return pool[randomIndex];
  }

  function getMessageForToday(today) {
    var key = dateKey(today);
    var isBirthday = (today.month === BIRTHDAY_MONTH && today.day === BIRTHDAY_DAY);

    if (isBirthday) {
      var storedB = loadStoredCard();
      if (!storedB || storedB.date !== key || !storedB.isBirthday) {
        saveStoredCard({
          date: key,
          isBirthday: true,
          messageType: "birthday",
          index: null
        });
      }
      return {
        text: BIRTHDAY_MESSAGE,
        isBirthday: true
      };
    }

    var stored = loadStoredCard();
    if (stored && stored.date === key && !stored.isBirthday && typeof stored.index === "number") {
      return {
        text: MESSAGES[stored.index],
        isBirthday: false,
        index: stored.index
      };
    }

    var history = loadHistory();
    var idx = pickMessageIndexWithNoRepeat(history);

    saveStoredCard({
      date: key,
      isBirthday: false,
      messageType: "normal",
      index: idx
    });

    var newHistory = [idx].concat(history).slice(0, NO_REPEAT_DAYS);
    saveHistory(newHistory);

    return {
      text: MESSAGES[idx],
      isBirthday: false,
      index: idx
    };
  }

  // Ezeket h√≠vj√°k a HTML-beli onclick-ek
  function openCard() {
    var scene = document.getElementById("scene");
    if (scene) {
      scene.classList.add("open");
    }
  }

  function closeCard() {
    var scene = document.getElementById("scene");
    if (scene) {
      scene.classList.remove("open");
    }
  }

  // ---- UI INIT ----
  document.addEventListener("DOMContentLoaded", function () {
    var today = getTodayInBucharest();

    var dateEl = document.getElementById("date");
    var envelopeDateEl = document.getElementById("envelopeDate");
    var messageEl = document.getElementById("message");

    var prettyDate = formatHungarianDate(today);
    dateEl.textContent = prettyDate;
    envelopeDateEl.textContent = prettyDate;

    var msg = getMessageForToday(today);
    messageEl.textContent = msg.text;
  });
</script>

</body>
</html>
